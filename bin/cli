#!/usr/bin/env node

const commander = require('commander')

const { Message, Wallet } = require('../lib/commands')

commander
  .version('1.0.0')
  
commander
  .command('wallet <address>')
  .description('Get status for wallet with <address>.')
  .option('-n, --network <network>', 'Connect to network: [mainnet|devnet]', 'mainnet')
  .option('-c, --node <node>', 'Connect directly to node <node>.')
  .option('-f, --format <format>', 'Specify how to format the output [json|table]', 'json')
  .option('-v, --verbose', 'Show verbose logging.')
  .action(async (address, cmd) => Wallet.status(address, cmd))
 
commander
  .command('create')
  .description('Create a new wallet.')
  .option('-n, --network <network>', 'Connect to network: [mainnet|devnet]', 'mainnet')
  .option('-c, --node <node>', 'Connect directly to node <node>.')
  .option('-f, --format <format>', 'Specify how to format the output [json|table]', 'json')
  .option('-v, --verbose', 'Show verbose logging.')
  .option('--vanity <string>', 'Create a vanity wallet that contains <string>.')
  .action(async (cmd) => {
    if(cmd.vanity) {
      await Wallet.vanity(cmd.vanity)
      return
    }
    await Wallet.create()
  })
  
commander
  .command('send <amount> <recepient>')
  .description('Send <amount> to <recepient>.')
  .option('-n, --network <network>', 'Connect to network: [mainnet|devnet]', 'mainnet')
  .option('-c, --node <node>', 'Connect directly to node <node>.')
  .option('-f, --format <format>', 'Specify how to format the output [json|table]', 'json')
  .option('-v, --verbose', 'Show verbose logging.')
  .option('-p, --passphrase <passphrase>', 'Enter your passphrase, if you do not enter e passphrase you will be prompted for it.')
  .option('-s, --smartbridge <smartbridge>', 'Enter a string for the SmartBridge.')
  .action(async (amount, recepient, cmd) => Wallet.send(amount, recepient, cmd))
  
commander
  .command('vote <delegate>')
  .description('Vote for <delegate>.')
  .option('-n, --network <network>', 'Connect to network: [mainnet|devnet]', 'mainnet')
  .option('-c, --node <node>', 'Connect directly to node <node>.')  
  .option('-f, --format <format>', 'Specify how to format the output [json|table]', 'json')
  .option('-v, --verbose', 'Show verbose logging.')
  .option('-p, --passphrase <passphrase>', 'Enter your passphrase, if you do not enter e passphrase you will be prompted for it.')
  .action(async (delegate,cmd) => Wallet.vote(delegate, cmd))
  
commander
  .command('delegate <username>')
  .description('Register as delegate with <username>.')
  .option('-n, --network <network>', 'Connect to network: [mainnet|devnet]', 'mainnet')
  .option('-c, --node <node>', 'Connect directly to node <node>.')  
  .option('-f, --format <format>', 'Specify how to format the output [json|table]', 'json')
  .option('-v, --verbose', 'Show verbose logging.')
  .option('-p, --passphrase <passphrase>', 'Enter your passphrase, if you do not enter e passphrase you will be prompted for it.')
  .action(async (username,cmd) => Wallet.delegate(username, cmd))
  
commander
  .command('stats')
  .description('Get the network stats.')
  .option('-n, --network <network>', 'Connect to network: [mainnet|devnet]', 'mainnet')
  .option('-c, --node <node>', 'Connect directly to node <node>.')  
  .option('-f, --format <format>', 'Specify how to format the output [json|table]', 'json')
  .option('-v, --verbose', 'Show verbose logging.')
  .action(async (cmd) => Wallet.delegate(cmd))
  
commander
  .command('sign <message>')
  .description('Sign <message>.')
  .option('-n, --network <network>', 'Connect to network: [mainnet|devnet]', 'mainnet')
  .option('-c, --node <node>', 'Connect directly to node <node>.')  
  .option('-f, --format <format>', 'Specify how to format the output [json|table]', 'json')
  .option('-v, --verbose', 'Show verbose logging.')
  .option('-p, --passphrase <passphrase>', 'Enter your passphrase, if you do not enter e passphrase you will be prompted for it.')
  .action(async (message, cmd) => Message.sign(message, cmd))
  
commander
  .command('verify <message> <publickey>')
  .description('Verify <message> with <publickey>.')
  .option('-n, --network <network>', 'Connect to network: [mainnet|devnet]', 'mainnet')
  .option('-c, --node <node>', 'Connect directly to node <node>.')  
  .option('-f, --format <format>', 'Specify how to format the output [json|table]', 'json')
  .option('-v, --verbose', 'Show verbose logging.')
  .action(async (message, publickey, cmd) => Message.verify(message, publickey, cmd))

if (!process.argv.slice(2).length) {
  commander.outputHelp()

  process.exit()
}

commander.parse(process.argv)